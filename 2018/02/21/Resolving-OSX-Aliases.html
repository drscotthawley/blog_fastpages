<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Resolving Mac OS X Aliases in Python | Scott H. Hawley</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Resolving Mac OS X Aliases in Python" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Mac OSX aliases are not symbolic links. Trying to read one will probably crash your code." />
<meta property="og:description" content="Mac OSX aliases are not symbolic links. Trying to read one will probably crash your code." />
<link rel="canonical" href="https://drscotthawley.github.io/blog/2018/02/21/Resolving-OSX-Aliases.html" />
<meta property="og:url" content="https://drscotthawley.github.io/blog/2018/02/21/Resolving-OSX-Aliases.html" />
<meta property="og:site_name" content="Scott H. Hawley" />
<meta property="og:image" content="https://cdn.osxdaily.com/wp-content/uploads/2012/06/remove-alias-arrows-mac.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-02-21T00:00:00-06:00" />
<script type="application/ld+json">
{"description":"Mac OSX aliases are not symbolic links. Trying to read one will probably crash your code.","@type":"BlogPosting","url":"https://drscotthawley.github.io/blog/2018/02/21/Resolving-OSX-Aliases.html","dateModified":"2018-02-21T00:00:00-06:00","datePublished":"2018-02-21T00:00:00-06:00","headline":"Resolving Mac OS X Aliases in Python","image":"https://cdn.osxdaily.com/wp-content/uploads/2012/06/remove-alias-arrows-mac.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://drscotthawley.github.io/blog/2018/02/21/Resolving-OSX-Aliases.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://drscotthawley.github.io/blog/feed.xml" title="Scott H. Hawley" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-173006102-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>

<link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Resolving Mac OS X Aliases in Python | Scott H. Hawley</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Resolving Mac OS X Aliases in Python" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Mac OSX aliases are not symbolic links. Trying to read one will probably crash your code." />
<meta property="og:description" content="Mac OSX aliases are not symbolic links. Trying to read one will probably crash your code." />
<link rel="canonical" href="https://drscotthawley.github.io/blog/2018/02/21/Resolving-OSX-Aliases.html" />
<meta property="og:url" content="https://drscotthawley.github.io/blog/2018/02/21/Resolving-OSX-Aliases.html" />
<meta property="og:site_name" content="Scott H. Hawley" />
<meta property="og:image" content="https://cdn.osxdaily.com/wp-content/uploads/2012/06/remove-alias-arrows-mac.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-02-21T00:00:00-06:00" />
<script type="application/ld+json">
{"description":"Mac OSX aliases are not symbolic links. Trying to read one will probably crash your code.","@type":"BlogPosting","url":"https://drscotthawley.github.io/blog/2018/02/21/Resolving-OSX-Aliases.html","dateModified":"2018-02-21T00:00:00-06:00","datePublished":"2018-02-21T00:00:00-06:00","headline":"Resolving Mac OS X Aliases in Python","image":"https://cdn.osxdaily.com/wp-content/uploads/2012/06/remove-alias-arrows-mac.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://drscotthawley.github.io/blog/2018/02/21/Resolving-OSX-Aliases.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://drscotthawley.github.io/blog/feed.xml" title="Scott H. Hawley" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-173006102-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Scott H. Hawley</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
<style>
ol.bibliography li { list-style: none }

ol li li{
    list-style-type: lower-alpha;
}

ol li li li{
    list-style-type: lower-roman;
}
</style>
  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Resolving Mac OS X Aliases in Python</h1><p class="page-description">Mac OSX aliases are not symbolic links. Trying to read one will probably crash your code.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2018-02-21T00:00:00-06:00" itemprop="datePublished">
        Feb 21, 2018
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      5 min read
    
</span></p>

    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Mac OSX aliases are not symbolic links. Trying to read one may crash your code.</p>

<p>In an app I’m developing, I want users to be able to easily create a “library” of symbolic links to
other places on their machine, and this is most easily achieved for many of them by Cmd-Option-Dragging and dropping the files.
This creates an “alias”, which is a special file that Apple dreamed up.  UNIX users are accustomed to symbolic links, and codes
written in UNIX will not follow or “resolve” Mac aliases. Instead, they will cause an exception to be thrown.</p>

<p>There used to be some libraries to handle this, but they relied on Apple’s old Carbon framework which is no longer supported.
There is a <a href="https://mac-alias.readthedocs.io/en/latest/">mac_alias</a> package but the documentation is lacking. So, I found an
<a href="https://hints.macworld.com/article.php?story=20021024064107356">old post on MacWorld</a> where one solution is given, and I ported that
for what I need.</p>

<p>Happy to share with you, so that you won’t have to worry about this.  As an added bonus, you can tell it to convert aliases to symbolic
links, so that “next time” you won’t have to deal with this.  Enjoy.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
#
# Resolve Mac OS X 'aliases' by finding where they point to
# Author: Scott H. Hawley
#
# Description:
# Mac OSX aliases are not symbolic links. Trying to read one will probably crash your code.
# Here a few routines to help. Run these to change the filename before trying to read a file.
# Intended to be called from within other python code
#
# Python port modified from https://hints.macworld.com/article.php?story=20021024064107356
#
# Requirements: osascript (AppleScript), platform, subprocess, shlex
#
# TODO: - could make it work in parallel when mutliple filenames are given
#
# NOTE: By default, this only returns the names of the original source files,
#       but if you set convert=True, it will also convert aliases to symbolic links.
#
</span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># returns true if a file is an OSX alias, false otherwise
</span><span class="k">def</span> <span class="nf">isAlias</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">already_checked_os</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">already_checked_os</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s">'Darwin'</span> <span class="o">!=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()):</span>  <span class="c1"># already_checked just saves a few microseconds ;-)
</span>        <span class="k">return</span> <span class="bp">False</span>
    <span class="n">checkpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>       <span class="c1"># osascript needs absolute paths
</span>    <span class="c1"># Next several lines are AppleScript
</span>    <span class="n">line_1</span><span class="o">=</span><span class="s">'tell application "Finder"'</span>
    <span class="n">line_2</span><span class="o">=</span><span class="s">'set theItem to (POSIX file "'</span><span class="o">+</span><span class="n">checkpath</span><span class="o">+</span><span class="s">'") as alias'</span>
    <span class="n">line_3</span><span class="o">=</span><span class="s">'if the kind of theItem is "alias" then'</span>
    <span class="n">line_4</span><span class="o">=</span><span class="s">'   return true'</span>
    <span class="n">line_5</span><span class="o">=</span><span class="s">'else'</span>
    <span class="n">line_6</span><span class="o">=</span><span class="s">'   return false'</span>
    <span class="n">line_7</span><span class="o">=</span><span class="s">'end if'</span>
    <span class="n">line_8</span><span class="o">=</span><span class="s">'end tell'</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s">"osascript -e '"</span><span class="o">+</span><span class="n">line_1</span><span class="o">+</span><span class="s">"' -e '"</span><span class="o">+</span><span class="n">line_2</span><span class="o">+</span><span class="s">"' -e '"</span><span class="o">+</span><span class="n">line_3</span><span class="o">+</span><span class="s">"' -e '"</span><span class="o">+</span><span class="n">line_4</span><span class="o">+</span><span class="s">"' -e '"</span><span class="o">+</span><span class="n">line_5</span><span class="o">+</span><span class="s">"' -e '"</span><span class="o">+</span><span class="n">line_6</span><span class="o">+</span><span class="s">"' -e '"</span><span class="o">+</span><span class="n">line_7</span><span class="o">+</span><span class="s">"' -e '"</span><span class="o">+</span><span class="n">line_8</span><span class="o">+</span><span class="s">"'"</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>      <span class="c1"># shlex splits cmd up appropriately so we can call subprocess.Popen with shell=False (better security)
</span>    <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
    <span class="n">retval</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">retval</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">line2</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'UTF-8'</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span><span class="s">''</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s">'true'</span> <span class="o">==</span> <span class="n">line2</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'resolve_osx_alias: Error: subprocess returned non-zero exit code '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">retval</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">None</span>


<span class="c1"># returns the full path of the file "pointed to" by the alias
</span><span class="k">def</span> <span class="nf">resolve_osx_alias</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">already_checked_os</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">convert</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>        <span class="c1"># single file/path name
</span>    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">already_checked_os</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s">'Darwin'</span> <span class="o">!=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()):</span>  <span class="c1"># already_checked just saves a few microseconds ;-)
</span>        <span class="k">return</span> <span class="n">path</span>
    <span class="n">checkpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>       <span class="c1"># osascript needs absolute paths
</span>    <span class="c1"># Next several lines are AppleScript
</span>    <span class="n">line_1</span><span class="o">=</span><span class="s">'tell application "Finder"'</span>
    <span class="n">line_2</span><span class="o">=</span><span class="s">'set theItem to (POSIX file "'</span><span class="o">+</span><span class="n">checkpath</span><span class="o">+</span><span class="s">'") as alias'</span>
    <span class="n">line_3</span><span class="o">=</span><span class="s">'if the kind of theItem is "alias" then'</span>
    <span class="n">line_4</span><span class="o">=</span><span class="s">'   get the posix path of (original item of theItem as text)'</span>
    <span class="n">line_5</span><span class="o">=</span><span class="s">'else'</span>
    <span class="n">line_6</span><span class="o">=</span><span class="s">'return "'</span><span class="o">+</span><span class="n">checkpath</span><span class="o">+</span><span class="s">'"'</span>
    <span class="n">line_7</span> <span class="o">=</span><span class="s">'end if'</span>
    <span class="n">line_8</span> <span class="o">=</span><span class="s">'end tell'</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s">"osascript -e '"</span><span class="o">+</span><span class="n">line_1</span><span class="o">+</span><span class="s">"' -e '"</span><span class="o">+</span><span class="n">line_2</span><span class="o">+</span><span class="s">"' -e '"</span><span class="o">+</span><span class="n">line_3</span><span class="o">+</span><span class="s">"' -e '"</span><span class="o">+</span><span class="n">line_4</span><span class="o">+</span><span class="s">"' -e '"</span><span class="o">+</span><span class="n">line_5</span><span class="o">+</span><span class="s">"' -e '"</span><span class="o">+</span><span class="n">line_6</span><span class="o">+</span><span class="s">"' -e '"</span><span class="o">+</span><span class="n">line_7</span><span class="o">+</span><span class="s">"' -e '"</span><span class="o">+</span><span class="n">line_8</span><span class="o">+</span><span class="s">"'"</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>              <span class="c1"># shlex splits cmd up appropriately so we can call subprocess.Popen with shell=False (better security)
</span>    <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
    <span class="n">retval</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">retval</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>        
        <span class="n">source</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'UTF-8'</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span><span class="s">''</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">convert</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">checkpath</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">checkpath</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'resolve_osx_aliases: Error: subprocess returned non-zero exit code '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">retval</span><span class="p">))</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s">''</span>
    <span class="k">return</span> <span class="n">source</span>


<span class="c1"># used for multiple files at a time, just a looped call to resolve_osx_alias
</span><span class="k">def</span> <span class="nf">resolve_osx_aliases</span><span class="p">(</span><span class="n">filelist</span><span class="p">,</span> <span class="n">convert</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>  <span class="c1"># multiple files
</span>    <span class="c1">#print("filelist = ",filelist)
</span>    <span class="k">if</span> <span class="p">(</span><span class="s">'Darwin'</span> <span class="o">!=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()):</span>
        <span class="k">return</span> <span class="n">filelist</span>
    <span class="n">outlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">resolve_osx_alias</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">already_checked_os</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">convert</span><span class="o">=</span><span class="n">convert</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s">''</span> <span class="o">!=</span> <span class="n">source</span><span class="p">):</span>
            <span class="n">outlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="c1">#print("outlist = ",outlist)
</span>    <span class="k">return</span> <span class="n">outlist</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">argparse</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Resolve OSX aliases'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'file'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"alias files to resolve"</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s">'+'</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">outlist</span> <span class="o">=</span> <span class="n">resolve_osx_aliases</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="nb">file</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"outlist = "</span><span class="p">,</span><span class="n">outlist</span><span class="p">)</span>
</code></pre></div></div>
<p>The above code is part of the <code class="highlighter-rouge">utils/</code> directory in my <a href="https://github.com/drscotthawley/panotti/tree/master/utils">Panotti</a> package.
The way it’s called is in the context of trying to read an audio file, called in the file <a href="https://github.com/drscotthawley/panotti/blob/master/panotti/datautils.py">panotti/datautils.py</a>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">load_audio</span><span class="p">(</span><span class="n">audio_path</span><span class="p">,</span> <span class="n">mono</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">convertOSXaliases</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>  <span class="c1"># wrapper for librosa.load
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">signal</span><span class="p">,</span> <span class="n">sr</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">audio_path</span><span class="p">,</span> <span class="n">mono</span><span class="o">=</span><span class="n">mono</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>       <span class="c1"># try to read the file 'normally'
</span>    <span class="k">except</span> <span class="n">NoBackendError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>                                      
        <span class="k">if</span> <span class="p">(</span><span class="s">'Darwin'</span> <span class="o">==</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()):</span>                           <span class="c1"># if an exception is thrown, check: Am I on a Mac? If so try to resolve an alias
</span>            <span class="n">source</span> <span class="o">=</span> <span class="n">resolve_osx_alias</span><span class="p">(</span><span class="n">audio_path</span><span class="p">,</span> <span class="n">convert</span><span class="o">=</span><span class="n">convertOSXaliases</span><span class="p">,</span> <span class="n">already_checked_os</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># ...and convert to symlinks for next time
</span>            <span class="k">try</span><span class="p">:</span>
                <span class="n">signal</span><span class="p">,</span> <span class="n">sr</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">mono</span><span class="o">=</span><span class="n">mono</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>   <span class="c1"># Now try to read again
</span>            <span class="k">except</span> <span class="n">NoBackendError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>                               <span class="c1"># Ok, even that didn't work, giving up (for now).
</span>                <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">*** ERROR: Could not open audio file {}"</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">audio_path</span><span class="p">),</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>                                                         <span class="c1"># Failure for some other reason.
</span>            <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">*** ERROR: Could not open audio file {}"</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">audio_path</span><span class="p">),</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
    <span class="k">return</span> <span class="n">signal</span><span class="p">,</span> <span class="n">sr</span>
</code></pre></div></div>

<p>Happy coding!</p>

<p><em>NOTE: Currently this code only follows _one_ alias.  If there’s an alias pointing to an alias to a file, it won’t resolve to that file.
Full generality would involve adding an iterative or recursive way of traversing multiple aliases which…I may do later. ;-)</em></p>

    <p class="bibliography"></p>
    <hr>
    <p>(c) 2020 Scott H. Hawley</p>
  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="drscotthawley/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/2018/02/21/Resolving-OSX-Aliases.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Physics prof / Tinkerer. My blog about code and ideas.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/drscotthawley" title="drscotthawley"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/drscotthawley" title="drscotthawley"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a rel="me" href="https://twitter.com/drscotthawley" title="drscotthawley"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
